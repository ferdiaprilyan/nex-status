<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEX — Status Bot</title>
  <link rel="stylesheet" href="style.css" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 class="title">NEX - Userbot</h1>
      <div class="row"><span id="status" class="pill">Memuat…</span><span id="ago" class="muted"></span></div>
      <div class="kv">
        <div>Terakhir</div><div id="last">-</div>
        <div>Versi</div><div id="versi">-</div>
        <div>Bot</div><div id="bot">-</div>
      </div>
    </div>
  </div>
  <script>
    const STATUS_URL = 'status.json';
    const THRESH_MS = 6 * 60 * 1000;

    function fmtAgo(ms){
      const s = Math.floor(ms/1000); if (s<60) return `${s}s`; const m=Math.floor(s/60); if (m<60) return `${m}m`; const h=Math.floor(m/60); return `${h}h ${m%60}m`; }
    function fmtUptime(sec){ const s=Number(sec||0); const h=Math.floor(s/3600); const m=Math.floor((s%3600)/60); const r=Math.floor(s%60); return h?`${h}h ${m}m ${r}s`:`${m}m ${r}s`; }
    function fmtTime(ts){ try{ const d=new Date(ts*1000); return d.toLocaleString(); }catch(_){ return '-'; } }

    async function refresh(){
      try{
        const res = await fetch(STATUS_URL+'?t='+(Date.now()));
        if (!res.ok) throw new Error('http '+res.status);
        const j = await res.json();
        const now = Date.now();
        const last = (j.ts||0)*1000;
        const diff = now - last;
        const online = (diff < THRESH_MS) && !!j.ok;
        const $s = document.getElementById('status');
        $s.className='pill '+(online?'ok':'bad');
        $s.textContent = online ? 'Online' : 'Offline';
        document.getElementById('ago').textContent = online ? `(update ${fmtAgo(diff)} lalu)` : `(terakhir ${fmtAgo(diff)} lalu)`;
        document.getElementById('last').textContent = fmtTime(j.ts||0);
        document.getElementById('versi').textContent = j.version || '-';
        document.getElementById('bot').textContent = j.bot || '-';
      }catch(e){
        const $s = document.getElementById('status');
        $s.className='pill bad';
        $s.textContent='Offline';
        document.getElementById('ago').textContent = '(status.json tidak terbaca)';
      }
    }
    refresh();
    setInterval(refresh, 360000);
  </script>
</body>
</html>
