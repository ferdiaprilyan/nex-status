<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEX — Status Bot</title>
  <style>
    :root { --ok:#16a34a; --bad:#dc2626; --muted:#6b7280; --bg:#0b0f14; --card:#0f1720; --fg:#e5e7eb; --accent:#60a5fa; }
    html,body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, 'Apple Color Emoji','Segoe UI Emoji'; }
    .wrap { max-width: 720px; margin: 6vh auto; padding: 16px; }
    .card { background: var(--card); border: 1px solid #16202b; border-radius: 10px; padding: 18px 20px; }
    .title { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 20px; margin: 0 0 6px; color: var(--accent); }
    .row { display:flex; gap:12px; align-items:center; margin: 10px 0; }
    .pill { padding: 6px 10px; border-radius: 999px; font-weight: 600; font-size: 14px; }
    .ok { background: color-mix(in srgb, var(--ok) 20%, transparent); color: var(--ok); border: 1px solid color-mix(in srgb, var(--ok) 60%, transparent); }
    .bad { background: color-mix(in srgb, var(--bad) 20%, transparent); color: var(--bad); border: 1px solid color-mix(in srgb, var(--bad) 60%, transparent); }
    .kv { display:grid; grid-template-columns: 140px 1fr; gap: 6px 12px; margin-top:12px; font-size: 14px; color:#cbd5e1; }
    .muted { color: var(--muted); }
    footer { margin-top: 18px; font-size: 12px; color: var(--muted); }
    a { color: var(--accent); text-decoration: none; }
  </style>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 class="title">NEX - Userbot</h1>
      <div class="row"><span id="status" class="pill">Memuat…</span><span id="ago" class="muted"></span></div>
      <div class="kv">
        <div>Terakhir</div><div id="last">-</div>
        <div>Uptime</div><div id="uptime">-</div>
        <div>Hostname</div><div id="host">-</div>
        <div>Versi</div><div id="versi">-</div>
        <div>Bot</div><div id="bot">-</div>
        <div>Owner</div><div id="owner">-</div>
      </div>
    </div>
  </div>
  <script>
    const STATUS_URL = 'status.json'; // relatif terhadap halaman ini
    const THRESH_MS = 1 * 60 * 1000; // 1 menit

    function fmtAgo(ms){
      const s = Math.floor(ms/1000); if (s<60) return `${s}s`; const m=Math.floor(s/60); if (m<60) return `${m}m`; const h=Math.floor(m/60); return `${h}h ${m%60}m`; }
    function fmtUptime(sec){ const s=Number(sec||0); const h=Math.floor(s/3600); const m=Math.floor((s%3600)/60); const r=Math.floor(s%60); return h?`${h}h ${m}m ${r}s`:`${m}m ${r}s`; }
    function fmtTime(ts){ try{ const d=new Date(ts*1000); return d.toLocaleString(); }catch(_){ return '-'; } }

    async function refresh(){
      try{
        const res = await fetch(STATUS_URL+'?t='+(Date.now()));
        if (!res.ok) throw new Error('http '+res.status);
        const j = await res.json();
        const now = Date.now();
        const last = (j.ts||0)*1000;
        const diff = now - last;
        const online = (diff < THRESH_MS) && !!j.ok;
        const $s = document.getElementById('status');
        $s.className='pill '+(online?'ok':'bad');
        $s.textContent = online ? 'Online' : 'Offline';
        document.getElementById('ago').textContent = online ? `(update ${fmtAgo(diff)} lalu)` : `(terakhir ${fmtAgo(diff)} lalu)`;
        document.getElementById('last').textContent = fmtTime(j.ts||0);
        const up = (j.started_at && j.ts) ? Math.max(0, Number(j.ts) - Number(j.started_at)) : Number(j.uptime||0);
        document.getElementById('uptime').textContent = fmtUptime(up);
        document.getElementById('host').textContent = j.hostname || '-';
        document.getElementById('versi').textContent = j.version || '-';
        document.getElementById('bot').textContent = j.bot || '-';
        document.getElementById('owner').textContent = j.owner ? String(j.owner) : '-';
      }catch(e){
        const $s = document.getElementById('status');
        $s.className='pill bad';
        $s.textContent='Offline';
        document.getElementById('ago').textContent = '(status.json tidak terbaca)';
      }
    }
    refresh();
    setInterval(refresh, 360000); // 6 menit
  </script>
</body>
</html>
